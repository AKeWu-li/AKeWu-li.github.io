---
title: 操作系统学习笔记（三）
date: 2021-09-29 20:24:00
tags: ["OS"]
---

## 开始

### 进程管理的背景

```language
交往的并发进程，共享某些变量，所以一个进程的执行可能影响其他进程的执行结果。同时，两个并发进程执行的相对速度无法相互控制，交往的并发进程的速率不仅受处理器调度的影响，而且还受到与这两个交往的并发进程无关的其他进程的影响，从而产生于时间有关的错误。
由于并发进程执行序列的随机性，会引起与时间有关的错误，这种错误表现为结果不唯一和永远等待两种情况。
```

### 进程互斥

```language
临界资源：在某段时间内只允许一个进程使用的资源。
临界区：并发进程中访问临界资源的程序段。
互斥：一种不允许两个以上共享共有资源或变量的进程同时进入临界区执行的性质，即相关临界区的执行必须具有排他性。（互斥通常是由于并发进程共享共有资源或变量而造成的执行速度上的间接制约）
```

```language
(1)互斥性：如果一个进程在它的临界区执行，那么其他进程均不能进入相关的临界区执行。
(2)进展性：如果一个进程不在它的临界区执行，不应阻止其他任何进程进入相关的临界区执行。
(3)有限等待性：某个进程从申请进入临界区开始，应该在有限的时间内得以进入临界区执行。（防止发生死锁）
```

#### 软件实现互斥

```language
(1)标志法
(2)严格轮换法
(3)Peterson算法
```

#### 硬件实现互斥

```language
(1)中断屏蔽方法
(2)硬件指令方法
```

<!-- more -->

#### P、V操作原语

```language
在多个互相合作的进程之间使用简单的信号来协调控制，一个进程检测到某个信号后，就被强迫停止在一个特定的地方，直到它收到一个专门的信号为止才能继续执行，这个信号就称为“信号量”。
信号量被定义为含有整型数据项的结构变量，其整型值大于等于零代表可供并发进程使用的资源实体数，但小于零时则表示正在等待使用临界区的进程数。
对信号量的操作有P、V原语实现。P操作P(s)：将信号量s的整型值减去1，若结果小于0，则调用P(s)的进程置成等待信号s的状态；V操作(s)：将信号量s的整型值加上1，若结果不大于0，则释放一个等待信号量s的进程。
```

### 进程同步

```language
概念：异步环境下的一组并发进程，因直接制约（各自的执行结果互为对方的执行条件，从而限制各进程执行速率的过程）互相发送消息而进程相互协作、相互等待，使得各进程按一定速度执行的过程。
```

```language
进程同步的信号量只与制约进程及被制约进程有关，而不是与整组并发进程有关。因此，用于控制进程同步的型号量可称为私有信号量。一个进程的私有信号量是指从制约进程发来的进程Pi的执行条件所需要的消息。（进程互斥的信号量称为公用信号量）
```

```language
P、V操作实现进程同步：首先为各并发进程设置私有信号量，然后为私有信号量赋初值，最后利用P、C操作和私有信号量为各进程设计执行顺序。
```



### 进程通信

```language
概念：一个进程将一批信息发送给另一个进程的过程。
```

#### 机制

```language
(1)共享存储器系统：进程之间通过共享的存储区进行通信。
(2)消息传递系统：进程间的数据交换以消息为单位，用户通过使用操作系统提供的一组消息通信原语来实现信息的传递。作为一种高级通信方式，其分为直接通信方式（发送进程把信件直接发送到接收进程，采用send原语和receive原语实现，可使用对称和非对称指名通信方式，其中非对称指的是接收者不必指出发送者）和间接通信方式（发送方发送消息到临时保存这些消息的队列，即信箱，信箱结构分为信箱特征和信箱体）。
(3)管道通信：管道指的是用于连接一个读进程和一个写进程，以实现进程之间通信的一种共享文件，又称为Pipe文件。这种机制具有互斥、同步、对方是否存在的协调能力。
```

#### 缓冲问题

```language
(1)缓冲器容量为0：指的是无信箱或无缓冲区的情形，如直接通信。
(2)缓冲区容量有界：如间接通信。
(3)缓冲区容量无界：这种情况发送进程永远无须等待缓冲区，但由于内存的有限性，无法真正实现。
```

#### 并行性问题

```language
当一个进程发送一封信件时，执行分为两种情况。一种是等待收到接收者的回答消息后才继续往下执行，接收者进程在接收到消息前也须等待，知道接收到消息后在向发送者进程发送一个回答消息，称为“双向通信”；另一种是发送信件后立即往下执行，直到某个时刻需要接收者进程送来的回答消息时，才对回答消息进行处理（需增加两条原语：answer和wait）。
```



### 死锁

```language
由于资源（包括永久性资源和临时性资源）使用不加合理的控制而引起的，一组进程相互等待对方所占有的资源，谁也无法继续执行，形成永远等待的现象。
```



#### 必要条件

```language
(1)互斥条件
(2)部分分配条件：一个进程已占有一定资源后，执行期间又再申请其他资源。
(3)不可抢占条件
(4)循环等待条件
```



#### 防止方法

````language
通过破坏部分分配条件和破坏循环等待条件，从而达到使死锁不发生的目的。
(1)资源的静态分配法：一个进程必须在执行前就申请它所需的全部资源，并且直到它所需的资源得到满足后才能开始执行。
(2)资源的层次分配法：把资源分为多个层次，一个进程在得到某一层的一个资源后，它只能再申请较高一层的资源；当一个进程要释放某层的一个资源时，必须先释放所占有的较高层的资源；当一个进程获得了某一层的一个资源后，再想申请该层中的另一个资源，则必须先释放该层中已占有的资源。（按序分配法）
````



#### 避免方法

```language
与防止的区别在于它不那么严格地限制死锁的必要条件，提高系统的资源利用率。
著名的避免死锁的方法：银行家算法。
```



#### 检测与恢复

```language
对资源的分配不加限制，但系统必须定时或不定时地运行一个“死锁检测程序”，判断系统是否出现死锁，若检测到死锁则采取相应的办法解除死锁，并以尽可能小的代价恢复相应的进程运行。
```



```language
对于所有资源只有一个实例的情形。死锁检测算法可基于等待图来检测，只要检测出等待图中存在一个环时，就意味着检测到了一个进程循环等待链，即存在死锁。等待图是从资源分配图（方形结点表示资源，圆形结点表示进程，从方形结点指向圆形结点的有向边表示某资源被某进程占有，从圆形指向方形的有向边表示某进程申请某资源）中得到的（从资源分配图中移除资源结点并合并相应的有向边，即可得到等待图）。当检测出死锁时，可通知操作员处理，另一种方法是操作系统自动解除死锁（撤销进程法和剥夺资源法）并在适当时机恢复相应进程运行（设立检查点）。
```



### 经典问题

```language
(1)读者-写者问题
(2)哲学家进餐问题
(3)打瞌睡的理发师问题
```



### 多核环境下的进程同步



## 结束