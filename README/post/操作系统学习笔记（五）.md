---
title: 操作系统学习笔记（五）
date: 2021-10-31 20:15:22
tags: ["OS"]
---

## 开始

### 存储管理的功能

#### 计算机多级存储结构

```language
(1)外部存储器：用来存放不立即使用的程序和数据。
(2)主存储器：一个程序的运行总是存放在主存中，以便处理器的访问。
(3)高速缓冲存储器：为了使处理机的处理速度和到存储器中存取的速度得到较好的匹配，引入了高速缓冲存储器，由硬件机构自动控制主存信息块与高速缓冲存储器信息块的交换，这样处理机读取指令和存取数据就在高速缓冲存储器中进行，从而平滑了主存与处理机的信息流动。
```

#### 存储管理的任务

```language
(1)为多道程序的并发提供良好的环境，使每道程序都能在不受干扰的环境中运行。
(2)提高存储器利用率，尽量减少空闲的及不可利用的主存储器区域，使得有限的主存能更好地为多个用户程序服务。
(3)逻辑上扩充主存空间，使大程序能在小主存中运行。
(4)方便用户使用存储器，用户无需考虑存储器的分配、回收和保护等工作，这些工作对于用户来说是“透明”的，完全由操作系统进行管理。
```

#### 存储管理的功能

```language
(1)存储空间的分配和回收
(2)地址映射
(3)存储共享与保护
(4)主存扩充
```

### 存储分配的形式

```language
(1)直接存储分配方式
(2)静态存储分配方式
(3)动态存储分配方式
注：重定位、覆盖技术与交换技术
```

<!-- more -->

### 单道环境下的存储管理

```language
在单道环境下，一般采用单一连续区存储管理，此方式存储空间除了被系统占用外，其他剩余空间全部被一个用户程序所占用。一般将存储空间划分为三个区域：系统区、用户区和剩余空闲区。单一连续区主要指主存只有一个用户程序使用。如果系统资源不能满足用户程序需求，则系统无法执行该程序，同时给出相应提示。
主要采用静态存储分配方式，即用户程序一旦调入主存后，必须等到该程序执行结束后才能释放主存空间。
```

#### 优缺点

```language
优点：管理简单，并且便于用户了解和使用。
缺点
(1)由于一个用户程序所要求的存储空间不会正好等于主存的可用空间，因此系统存储空间的浪费较大。
(2)当正在执行的程序因为等待某个事件，处理器就处于空闲状态。
(3)单一连续区存储管理方式限制了用户程序和系统程序的可重入性，因而主存中的程序和数据都不能被共享。
(4)系统的外围设备也只有一个程序使用，利用率低。
```

### 分区存储管理

```language
将主存的用户可用区划分成若干个大小不等的区域，每一个进程占据一个或多个区域，从而实现多道程序设计环境下各并发进程共享主存空间。
```

#### 优点

```language
(1)实现了多道程序设计，从而提高了系统资源利用率。
(2)系统要求的硬件支持少，管理简单，实现容易。
```

#### 缺点

```language
(1)由于作业在装入时的连续性，导致主存的利用率不高。采用移动技术可以提高利用率，但增加了开销，同时也带来了一些棘手的问题，如与外部设备交换信息的出错问题，动态主存扩充的死锁问题等。
(2)主存的扩充只能采用覆盖和交换技术，无法真正实现虚拟储存。
```



#### 固定分区法

```language
系统在初始化时，将主存空间划分为若干个固定大小的区域。用户程序在执行过程中，不允许改变划分区域的大小，只能根据各自的要求，由系统分配一个存储区域。
```



#### 动态分区法

```language
在系统初启时，除了操作系统中常驻主存部分以外，只存在一个空闲分区。随后，分配程序将该区域依次划分给调度程序选中的进程，并且分配的大小可随用户进程对主存的需求而改变。
```



##### 分配方式

```language
(1)最先适应法
(2)最佳适应法
(3)最坏适应法
```



#### 移动技术

```language
改变主存中的作业存放区域，同时修改他们的基址/限长值，从而使分散的小空闲区汇集成一个大的空闲区，有利于作业的装入。
```



### 页式存储管理

```language
将作业分配在不连续的大小相同存储区域中，实现主存“见缝插针”式的分配，同时又要保证作业的连续执行。
```

```language
1.实现了连续存储到非连续存储的飞跃，为实现虚拟存储打下了基础。
2.解决了主存中的“碎片”问题，因为从分配思想上来看，已不存在空闲的页框不可利用的问题，尽管每个进程的最后一页不一定占满整个页框，这部分未占满页框的存储区域成为“内碎片”或“内零头”，任意一个“内碎片”都不会大于整个页框的大小，从而提高了主存的利用率。
```

#### 静态页式存储管理

```language
用户作业在开始执行前，将该作业的程序和数据全部装入到主存中，然后，操作系统通过页表和硬件地址变换机构实现逻辑地址到物理地址的转换。
```

##### 主存页框的分配和回收

```language
(1)页表：页面映像表，将程序中的逻辑地址变换为物理地址，即进行动态重定位。页表中至少需要两个信息：页号和页面对应的页框，每个进程至少拥有一张页表。
(2)请求表：用来确定作业或进程的虚拟地址空间的各页表在主存中的实际对应位置。内容包括：进程号、请求页面数、页表始址、页表长度和状态等。
(3)存储页框表：指出主存各页框是否已被分配，以及未被分配的页框总数。两种形式：位示图和空闲页框链。
(4)页框分配算法：1.从请求表中查出作业或进程所要求的页框数；2.由存储页框表检查是否有空闲页框（块），若没有，则本次无法分配；如果有，则分配并设置页表，填写请求表中相应的表项（页表始址、页表长度和状态）；3.按一定的查找算法，搜索出所要求的空闲页框（块），并将对应的页框（块）号填入页表中。
(5)页框回收算法：当进程执行完毕后，根据进程页表中登记的页框（块）号，将这些页框（块）插入到存储页框表中，使之成为空闲页框。然后，拆除该进程所对应的页表即可。
```

##### 页式地址变换

```language
为了保证在非连续的存储区域中正确的执行程序，操作系统必须提供一套地址变换机构，来完成逻辑地址到物理地址的转换。以下介绍其过程：
```

```language
(1)操作系统根据主存页框的大小将进程要求的存储空间分成相应的页面。
(2)根据主存的实际情况，将进程的每个页面分配到主存空闲页框中，同时，系统分配并设置页表的内容（通常一个进程具备一个页表）。此时，系统完成用户进程的存储器分配。
(3)当用户进程开始执行时，系统首先设置控制寄存器的内容，控制寄存器包括页表长度和页表起始地址两项。
(4)为了对逻辑地址进行变换，由硬件组成的地址变换机构必须将其分成两部分：页号和页内偏移。
(5)根据逻辑地址中提供的页号在页表中找到相对应的页框号。
(6)将页表中的页框号和逻辑地址中的页内偏移分别写入绝对地址中的相应位置上。
(7)根据绝对地址提供的页号和页内偏移计算出存储空间的物理地址。此时，用户进程便可以访问主存中的绝对地址，取出数据或取出指令执行。
```

##### 快表

```language
为了尽量减少访问主存的次数，提高地址变换的速度，可在地址变换机构中增设一个具有并行查询能力的特殊高速缓冲存储器，用来存放页表的一部分，存放在高速缓冲存储器中的页表称为“快表”。通常存放64~256个页表项。
```

##### 页的共享

```language
实现数据共享时，可允许不同的作业对共享数据页使用不同的页号，只要让各自页表中的相关表目指向共享的数据信息块（页框）就可以了。
实现程序共享时，由于页式存储结构要求逻辑地址空间是连续的，共享程序必须含有转移指令，所以在程序运行前共享程序的页号必须是确定的。
```

###### 共享信息的保护方法

```language
(1)在页表中增加一个保护权限域，用来指出该页的信息为：可读/写、只读、只执行和不可访问等。
(2)保护键法
```

#### 虚拟页式存储管理

```language
从逻辑上扩充主存的容量
```

##### 基本思想

```language
系统将当前要用的程序和数据放在主存中启动程序运行，而暂时不用的程序和数据驻留在外存中。在执行中需要用到不在主存中的信息时，通过系统的调入、调出功能和置换功能将暂时不用的程序的数据调出主存，腾出空间让系统调入要用的程序和数据。
```

##### 特征

```language
(1)多次性
(2)对换性
```

##### 页表增加项

```language
(1)状态位
(2)访问字段
(3)修改位
(4)保护权限
(5)外存地址
```

##### 硬件环境

```language
(1)具有一定容量主存
(2)相当容量外存
(3)地址变换机构
(4)缺页中断机构
```

##### 工作流程

```language
(1)为用户作业或进程分配主存工作区并填写相应的页表项目
(2)由进程调度程序调度用户进程执行
```

##### 页面置换

###### 调页策略

```language
(1)预调页策略
(2)请求调页策略
```

###### 分配策略

```language
(1)固定分配策略
(2)可变分配策略
```

###### 页面置换算法

```language
(1)优化(OPT)算法
(2)先进先出(FIFO)算法
(3)最近最少用(LRU)置换算法
(4)最近未用(NRU)置换算法
(5)最少使用(LFU)置换算法
(6)第二次机会算法
(7)时钟(Clock)算法
(8)基于Clock的NRU算法
```

##### 优缺点

```language
优点
(1)解决主存的零头问题，能有效地利用主存。
(2)方便多道程序设计，并且程序运行的道数增加了。
(3)可提供大容量的虚拟存储器，作业的地址空间不再受实际主存大小的限制。
(4)更加方便了用户，特别是大作业的用户。当某作业地址空间超过主存空间限制时，用户也无须考虑覆盖结构。
缺点
(1)要求有相应的硬件支持。
(2)必须提供相应的数据结构来管理存储器，而这些数据结构不仅占用了部分主存空间，同时他们的建立和管理都要花费CPU的时间。
(3)虽然解决了分区管理中区间的零头问题，但在页式存储管理系统中页内的零头问题仍然存在。
(4)对于静态页式存储管理系统，用户作业要求一次性装入主存，将给用户作业的运行带来一定的限制。
(5)在请求页式存储管理中，需要进行缺页中断处理，特别是请求调页的算法若选择不当，还有可能出现抖动的情况，增加了系统开销，降低系统效率。
```

### 段式存储管理

```language
把程序按逻辑含义或过程（函数）关系分成段，每段都有自己的名字，这个名字称为段名。用户程序可用段名和入口指出调用一个段的功能，程序在编译或汇编时，再将段名定义一个段号。每段逻辑地址均是以0开始进行顺序编址。这样用户作业或进程的地址空间就形成了一个二维线性地址空间，任意一个地址必须首先指出段号，其次再指出段内偏移地址。段式存储管理程序以段为单位分配主存，然后执行时通过地址转换机构吧段式逻辑地址转换成主存物理地址。
```

#### 实现原理

```language
把用户作业按逻辑意义分成若干段，每段均是从0开始编址，段内地址是连续的，而段与段之间的地址不连续。一旦地址结构确定了，那么这个系统中一个作业允许的最多段数和每段的最大长度就确定了。
```

#### 虚拟存储管理

##### 实现原理

```language
把作业的所有分段的副本都存放在外存上，当作业被调度投入允许时，首先把当前需要用的一段或几段装入主存，在执行过程中，访问到不在主存的段时，再通过缺段中断机构把它从外存上调入。
```

##### 段表

```language
特征位：用两位表示相应的段是否在主存，是否可共享；
存取权限：用两位表示相应端只执行、只读或可读/写的权限；
标志位：用两位表示相应段是否已被修改过和能否移动；
扩充位：用一位表示相应段是固定长还是可扩充；
访问位：用来表示段的活动状况，作为淘汰时参考；
主存地址：表示该段在主存中的开始地址；
长度：指出了该段的地址单元数；
外存始址：登记该段在外存中副本的起始地址。
```

##### 动态连接

```language
指在程序运行中对它所用到的子程序或数据段进行动态装配，节省连接装配时间和程序所占的空间。
实现动态连接系统应增加两个功能：间接编址和连接障碍指示。
```

### 段页式虚拟存储管理

```language
系统中每个作业按逻辑分段，然后对每一段又分成若干页。这样，每一段不必占用连续的主存空间，而是按页存放在不一定连续的主存页框中，并且当主存页框不够时只将一段的部分页面放在主存，用到不在主存中的页面时再将之调入。
```

```language
必须为每个作业设立一张段表和若干张页表，段表中应指出每段的页表始址和长度及其他特征信息。
```

```language
在进行地址转换时，根据逻辑地址中的段号查段表得相应段的页表始址，然后根据页号查页表得到对应的主存页框号，有页框号和页内偏移就可以形成欲访问的绝对地址。
```

```language
可能会发生的中断：
(1)缺段中断
(2)越界中断
(3)保护中断
(4)缺页中断
(5)连接中断
```



## 结束
